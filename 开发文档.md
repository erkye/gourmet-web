# 菜谱分享小程序开发文档

## 数据库

**概览**

* 菜谱主表
* 用料表
* 菜谱浏览记录表
* 分类表（两级或三级分类）
* 用户表
* 用户收藏表

**表详细**

* 菜谱主表（gourmet_menu）

  | 字段名    | 类型    | 备注                     |
  | --------- | ------- | ------------------------ |
  | id        | int     | 主键，自增               |
  | img       | varchar | 菜谱图片url              |
  | title     | varchar | 菜谱标题                 |
  | introd    | varchar | 菜谱简介                 |
  | content   | text    | 菜谱内容（html）         |
  | nickname  | varchar | 作者昵称                 |
  | recommend | tinyint | 是否是推荐（首页轮播图） |

* 用料表（gourmet_materials）

  | 字段名   | 类型    | 备注                 |
  | -------- | ------- | -------------------- |
  | id       | int     | 主键，自增           |
  | menu_id  | int     | 外键（菜谱主表的id） |
  | name     | varchar | 材料名称             |
  | quantity | varchar | 用量                 |

* 菜谱浏览记录表（gourmet_menu_scan）

  | 字段名    | 类型 | 备注                 |
  | --------- | ---- | -------------------- |
  | id        | int  | 主键，自增           |
  | menu_id   | int  | 外键（菜谱主表的id） |
  | pageviews | int  | 浏览量               |
  | favorites | int  | 收藏量               |

* 分类表（gourmet_classify）

  | 字段名    | 类型    | 备注       |
  | --------- | ------- | ---------- |
  | id        | int     | 主键，自增 |
  | name      | varchar | 分类名称   |
  | parent_id | int     | 父级分类id |

* 用户表（gourmet_user）

  | 字段名    | 类型    | 备注       |
  | --------- | ------- | ---------- |
  | id        | int     | 主键，自增 |
  | nick_name | varchar | 用户昵称   |

* 用户收藏表（gourmet_star）

  | 字段名  | 类型 | 备注                         |
  | ------- | ---- | ---------------------------- |
  | user_id | int  | 双主键，用户表外键，用户表id |
  | menu_id | int  | 双主键，菜谱表外键，菜谱表id |

### 数据库创建

![image-20201008191326317](https://gitee.com//lifazhan/mypics/raw/master/img/20201008191335.png)

**数据库名称：gourmet**

**字符集：utf8mb4**

**排序规则：utf8mb4_general_ci**



**数据库创建SQL语句**

* ​	用户表 gourmet_user

  ```sql
  CREATE TABLE `gourmet_user` (
    `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键，自增',
    `nick_name` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT '用户昵称',
    PRIMARY KEY (`id`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
  ```

* 菜谱表 gourmet_menu

  ```sql
  CREATE TABLE `gourmet_menu` (
    `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键，自增',
    `img` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT '菜谱图片url',
    `title` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT '菜谱标题',
    `introd` varchar(255) COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '菜谱简介',
    `content` text COLLATE utf8mb4_general_ci NOT NULL COMMENT '菜谱内容（html）',
    `nickname` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT '作者昵称',
    `recommend` tinyint(1) unsigned NOT NULL DEFAULT '0' COMMENT '是否是推荐（首页轮播图）',
    PRIMARY KEY (`id`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
  ```

* 分类表 gourmet_classify

  ```sql
  CREATE TABLE `gourmet_classify` (
    `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键，自增',
    `name` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT '分类名称',
    `parent_id` int(10) DEFAULT '-1' COMMENT '父级分类id',
    PRIMARY KEY (`id`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
  ```

* 材料表 gourmet_materials

  ```sql
  CREATE TABLE `gourmet_materials` (
    `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键，自增',
    `menu_id` int(11) unsigned NOT NULL COMMENT '外键（菜谱主表的id）',
    `name` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT '材料名称',
    `quantity` varchar(255) COLLATE utf8mb4_general_ci NOT NULL COMMENT '用量',
    PRIMARY KEY (`id`),
    KEY `fk_menu_materials` (`menu_id`),
    CONSTRAINT `fk_menu_materials` FOREIGN KEY (`menu_id`) REFERENCES `gourmet_menu` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
  ```

* 菜谱浏览记录表 gourmet_menu_scan

  ```sql
  CREATE TABLE `gourmet_menu_scan` (
    `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键，自增',
    `menu_id` int(10) unsigned NOT NULL COMMENT '外键（菜谱主表的id）',
    `pageviews` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '浏览量',
    `favorites` bigint(20) unsigned NOT NULL DEFAULT '0' COMMENT '收藏量',
    PRIMARY KEY (`id`),
    KEY `fk_menu_scan` (`menu_id`),
    CONSTRAINT `fk_menu_scan` FOREIGN KEY (`menu_id`) REFERENCES `gourmet_menu` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
  ```

## 服务端搭建

SpringBoot + MyBatis

## 前后端交互

统一使用axios

**使用方式：**

* 使用npm安装，目录下要有package.json，没有的话执行下面命令

  ```
  npm init
  ```

* 安装axios

  ```
  npm i axios axios-miniprogram-adapter
  ```

* 微信开发者工具点击：工具--构建npm，项目中出现miniprogram_npm文件夹表示构建成功

* 使用，再resquest目录下创建了一个http.js 文件，抽离出创建axios实例的方法，使用页面直接引用此文件即可使用axios

  ```js
  import axios from 'axios'
  import mpAdapter from 'axios-miniprogram-adapter'
  axios.defaults.adapter = mpAdapter
  
  // 构建axios实例
  const http = axios.create({
    baseURL: 'http://localhost:3000/api'
  })
  
  // 到处实例
  module.exports = http 
  ```

  **注意：小程序调试基本库需要设置为较新的版本（此处设置为 2.13.1）**

  使用：

  ```js
  import http from '../../resquent/http'
  ```

  请求示例：

  ```js
  // 获取滑动视图的数据
    async getSwipperData(){
      const {data:response} = await http.get('/menu/recommend')
      console.log(response)
    }
  ```

  此处使用了 ES7 的 async/await 语法来获取异步请求的数据，小程序较新的调试基本库支持 ES7（ES7 转 ES5） 语法，{data:response} 作用是将响应数据对象中data属性映射为response

